# Stripe iOS Bindings

The Stripe iOS bindings can be used to generate [tokens](https://stripe.com/docs/api#tokens) in your iOS application.  If you are building an iOS application that charges a credit card, you should use these bindings to make sure you don't pass credit card information to your server (and, thus, are PCI compliant).

## Installation

1. Clone this Github repository somewhere
1. Add the files in `src` to your iOS or OS X project in Xcode by clicking on File->Add files to "Project"...

## Guide

There are three main classes in the Stripe iOS bindings that you should care about.  `STPCard` is a representation of a credit card.  You will need to create and populate this object with the credit card details a customer enters.  `STPToken` is a representation of the token Stripe returns for a credit card.  You can't generate these.  `Stripe` is a static class that you use to interact with the Stripe REST API.

### Creating a token

    STPCard *card = [[STPCard alloc] init];
    card.number = @"4242424242424242";
    card.expMonth = 12;
    card.expYear = 2020;

    [Stripe createTokenWithCard:card publishableKey:@"my_publishable_key"
    completionHandler:^(STPToken *token, NSError *error)
    {
        if (error)
        	NSLog(@"Error trying to create token %@", [error localizedDescription]);
        else
        	NSLog(@"Oh the sweet silence of success! Now I should send my data
        	along with this token to my server, where I can use the token to
        	charge the card or create a Stripe customer.");
    }];

Note that if you do not wish to send your publishableKey every time you make a call to createTokenWithCard, you can also call `[Stripe setDefaultPublishableKey:]` with your publishable key, and all Stripe API requests will use this key.

### Retrieving a token

If you're implementing a complex workflow, you may want to know if you've already charged a token (since they can only be charged once).  You can do so if you have the token's ID:

    [Stripe getTokenWithId:@"token_id" publishableKey:@"my_publishable_key"
    completionHandler:^(STPToken *token, NSError *error)
    {
    	if (error)
    	    NSLog(@"An error!");
    	else
    	    NSLog(@"A token for my troubles.");
    }];

### Handling errors

Expected errors, such as a card being invalid or our API returning a non-200 response code, generate NSError objects.  This is different from our other bindings, which generate exceptions for these situations.  All errors generated by the bindings are in the `StripeDomain` domain and have a `code` of `STPInvalidRequestError`, `STPAPIError`, or `STPCardError` -- these match up to the `type` property of [errors returned by our API](https://stripe.com/docs/api#errors).

<This section needs to be finished>

### Operation queues

### Validation

## Running the tests

1. Open Stripe.xcodeproj
1. Select either the iOS or OS X scheme in the toolbar at the top
1. Go to Product->Test

## iOS Example

Run the "TreatCar" target.  This is a simple application that lets you order treat cars from an iOS device.

## OS X Support

OS X support is not yet well tested (though all the tests do run).  Feel free to give it a try and let us know of any problems you run into!